<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Town</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #000;
        }
        canvas { 
            display: block; 
            margin: 0 auto;
            background: #000;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        // Game constants
        const WIDTH = 800;
        const HEIGHT = 600;
        const WORLD_SIZE = 64.0;
        const ZOMBIE_SPAWN_RADIUS = 6.0;
        const ZOMBIE_BOUNDARY = 12.0;

        // Game variables
        let canvas, gl;
        let zombies = [];
        let cameraAngleX = 30.0;
        let cameraAngleY = 0.0;
        let score = 0;
        let wave = 1;
        let lastWaveTime = Date.now();
        let zombiesKilled = 0;
        let zombiesNeededForNextWave = 10;

        // Initialize WebGL
        function init() {
            canvas = document.getElementById('gameCanvas');
            canvas.width = WIDTH;
            canvas.height = HEIGHT;
            
            try {
                gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) {
                    alert('WebGL not supported in your browser!');
                    return;
                }
            } catch (e) {
                alert('Error initializing WebGL: ' + e);
                return;
            }

            // Basic WebGL setup
            gl.clearColor(0.0, 0.0, 0.0, 1.0);
            gl.enable(gl.DEPTH_TEST);
            gl.viewport(0, 0, canvas.width, canvas.height);

            // Set up projection matrix
            const fieldOfView = 45 * Math.PI / 180;
            const aspect = canvas.width / canvas.height;
            const zNear = 0.1;
            const zFar = 100.0;
            const projectionMatrix = mat4.create();
            mat4.perspective(projectionMatrix, fieldOfView, aspect, zNear, zFar);

            // Set up model-view matrix
            const modelViewMatrix = mat4.create();
            mat4.translate(modelViewMatrix, modelViewMatrix, [0.0, 0.0, -15.0]);

            // Start the game
            spawnInitialZombies();
            requestAnimationFrame(gameLoop);
        }

        // Game objects
        class Zombie {
            constructor(x, y, z) {
                this.x = x;
                this.y = y;
                this.z = z;
                this.rotation = 0;
                this.speed = 0.03;
                this.isDying = false;
                this.deathTimer = 0;
            }

            update() {
                if (this.isDying) {
                    this.deathTimer += 0.1;
                    this.y -= 0.1;
                    return;
                }

                this.rotation += 0.01;
                this.x += Math.sin(this.rotation) * this.speed;
                this.z += Math.cos(this.rotation) * this.speed;

                // Boundary check
                if (this.x < -ZOMBIE_BOUNDARY || this.x > ZOMBIE_BOUNDARY ||
                    this.z < -ZOMBIE_BOUNDARY || this.z > ZOMBIE_BOUNDARY) {
                    this.rotation = Math.random() * Math.PI * 2;
                }
            }

            render() {
                const modelViewMatrix = mat4.create();
                mat4.translate(modelViewMatrix, modelViewMatrix, [this.x, this.y, this.z]);
                mat4.rotate(modelViewMatrix, modelViewMatrix, this.rotation, [0, 1, 0]);

                if (this.isDying) {
                    mat4.rotate(modelViewMatrix, modelViewMatrix, this.deathTimer, [1, 0, 1]);
                }

                // Simple cube rendering
                gl.uniformMatrix4fv(uModelViewMatrix, false, modelViewMatrix);
                gl.drawArrays(gl.TRIANGLES, 0, 36);
            }

            hit() {
                if (!this.isDying) {
                    this.isDying = true;
                    score += 10 * wave;
                    zombiesKilled++;
                }
            }

            isDead() {
                return this.isDying && this.deathTimer > 3.0;
            }
        }

        // Game functions
        function spawnInitialZombies() {
            for (let i = 0; i < 10; i++) {
                spawnZombie();
            }
        }

        function spawnZombie() {
            const angle = Math.random() * Math.PI * 2;
            const radius = Math.random() * ZOMBIE_SPAWN_RADIUS;
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;
            zombies.push(new Zombie(x, 0, z));
        }

        function update() {
            const currentTime = Date.now();
            
            // Wave system
            if (currentTime - lastWaveTime > 30000) {
                wave++;
                zombiesNeededForNextWave = 10 + wave * 5;
                lastWaveTime = currentTime;
                for (let i = 0; i < 5 + wave * 3; i++) {
                    spawnZombie();
                }
            }

            // Update zombies
            for (let i = zombies.length - 1; i >= 0; i--) {
                zombies[i].update();
                if (zombies[i].isDead()) {
                    zombies.splice(i, 1);
                }
            }

            // Check for next wave
            if (zombiesKilled >= zombiesNeededForNextWave) {
                wave++;
                zombiesKilled = 0;
                zombiesNeededForNextWave = 10 + wave * 5;
                lastWaveTime = currentTime;
                for (let i = 0; i < 5 + wave * 3; i++) {
                    spawnZombie();
                }
            }

            // Update camera
            cameraAngleY = (cameraAngleY + 0.5) % 360;
        }

        function render() {
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

            // Set up view matrix
            const viewMatrix = mat4.create();
            mat4.translate(viewMatrix, viewMatrix, [0.0, 0.0, -15.0]);
            mat4.rotate(viewMatrix, viewMatrix, cameraAngleX * Math.PI / 180, [1, 0, 0]);
            mat4.rotate(viewMatrix, viewMatrix, cameraAngleY * Math.PI / 180, [0, 1, 0]);

            // Render zombies
            zombies.forEach(zombie => zombie.render());

            // Render platform
            renderPlatform();

            // Render UI
            renderUI();
        }

        function renderPlatform() {
            const modelMatrix = mat4.create();
            mat4.translate(modelMatrix, modelMatrix, [0, -1, 0]);
            mat4.scale(modelMatrix, modelMatrix, [WORLD_SIZE, 0.1, WORLD_SIZE]);
            gl.uniformMatrix4fv(uModelViewMatrix, false, modelMatrix);
            gl.drawArrays(gl.TRIANGLES, 0, 36);
        }

        function renderUI() {
            // Simple text rendering would go here
            // For now we'll just log the stats
            console.log(`Score: ${score} | Wave: ${wave} | Zombies: ${zombies.length}`);
        }

        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        // Initialize the game when the page loads
        window.onload = function() {
            // Load gl-matrix library dynamically
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js';
            script.onload = init;
            document.head.appendChild(script);
        };
    </script>
</body>
</html>
